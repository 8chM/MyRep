blueprint:
  name: Thermostat-Steuerung
  description: Automatisierte Steuerung eines Thermostats basierend auf Anwesenheit und Zeit.
  domain: automation
  input:
    presence_entity:
      name: Anwesenheits-Entity
      description: Die Entity, die den Anwesenheitsstatus angibt.
      selector:
        entity:
          domain: device_tracker
    thermostat_entity:
      name: Thermostat-Entity
      description: Die Entity, die das zu steuernde Thermostat darstellt.
      selector:
        entity:
          domain: climate
    anwesenheit_1:
      name: Zeitpunkt des ersten Anwesenheitszeitraums
      description: Zeitpunkt, ab dem der erste Anwesenheitszeitraum beginnt.
      selector:
        time: {}
    anwesenheit_temp_1:
      name: Temperatur des ersten Anwesenheitszeitraums
      description: Die gewünschte Temperatur während des ersten Anwesenheitszeitraums.
      selector:
        number:
          min: 5
          max: 30
          step: 0.5
          unit_of_measurement: "°C"
    anwesenheit_2:
      name: Zeitpunkt des zweiten Anwesenheitszeitraums
      description: Zeitpunkt, ab dem der zweite Anwesenheitszeitraum beginnt.
      selector:
        time: {}
    anwesenheit_temp_2:
      name: Temperatur des zweiten Anwesenheitszeitraums
      description: Die gewünschte Temperatur während des zweiten Anwesenheitszeitraums.
      selector:
        number:
          min: 5
          max: 30
          step: 0.5
          unit_of_measurement: "°C"
    abwesenheit_temp:
      name: Temperatur bei Abwesenheit
      description: Die gewünschte Temperatur während der Abwesenheit.
      selector:
        number:
          min: 5
          max: 30
          step: 0.5
          unit_of_measurement: "°C"
  trigger:
    platform: state
    entity_id: !input presence_entity
    to: home
  condition:
    condition: state
    entity_id: !input presence_entity
    state: home
  action:
    - choose:
        - conditions:
            - condition: time
              after: !input anwesenheit_1
              before: !input anwesenheit_2
          sequence:
            - service: climate.set_temperature
              target:
                entity_id: !input thermostat_entity
              data:
                temperature: !input anwesenheit_temp_1
        - conditions:
            - condition: time
              after: !input anwesenheit_2
          sequence:
            - service: climate.set_temperature
              target:
                entity_id: !input thermostat_entity
              data:
                temperature: !input anwesenheit_temp_2
        - sequence:
            - service: climate.set_temperature
              target:
                entity_id: !input thermostat_entity
              data:
                temperature: !input abwesenheit
