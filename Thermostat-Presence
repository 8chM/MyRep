blueprint:
  name: Thermostat-Steuerung mit Präsenzerkennung
  description: Automatische Steuerung des Thermostats basierend auf Präsenzerkennung und Außentemperatur
  domain: automation
  input:
    thermostat_entity:
      name: Thermostat
      description: Das zu steuernde Thermostat
      selector:
        entity:
          domain: climate
    presence_entity:
      name: Präsenz-Entity
      description: Die Entity zur Erkennung der Präsenz
      selector:
        entity:
          domain: device_tracker
    max_temp:
      name: Maximale Temperatur
      description: Die maximale zulässige Temperatur für das Thermostat
      default: 25
      selector:
        number:
          min: 0
          max: 35
          step: 0.1
          mode: slider
    min_temp:
      name: Minimale Temperatur
      description: Die minimale zulässige Temperatur für das Thermostat
      default: 15
      selector:
        number:
          min: 0
          max: 35
          step: 0.1
          mode: slider
  source_url: https://github.com/8chM/MyRep/blob/main/Thermostat-Presence.yaml
trigger:
  - platform: state
    entity_id: !input presence_entity
action:
  - choose:
      - conditions:
          - condition: state
            entity_id: !input presence_entity
            state: "home"
        sequence:
          - service: climate.set_temperature
            target:
              entity_id: !input thermostat_entity
            data:
              temperature: "{{ states('sensor.outdoor_temperature') | float | round(1) }}"
      - conditions:
          - condition: state
            entity_id: !input presence_entity
            state: "not_home"
        sequence:
          - service: climate.set_temperature
            target:
              entity_id: !input thermostat_entity
            data:
              temperature: "{{ states('sensor.outdoor_temperature') | float | round(1) - 1 }}"
    default:
      - service: climate.set_temperature
        target:
          entity_id: !input thermostat_entity
        data:
          temperature: "{{ states('sensor.outdoor_temperature') | float | round(1) }}"
condition:
  - condition: state
    entity_id: !input presence_check_entity
    state: "home"
max_exceeded:
  - silent
mode: single
